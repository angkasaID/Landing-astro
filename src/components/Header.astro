---
// src/components/Header.astro (FINAL UTUH: Active State, Size Chart, Image Gallery, + Category Sidebar)

const currentPath = Astro.url.pathname.trim(); 
const isHomePage = currentPath === '/' || currentPath === '/index.html'; 

// 1. Tentukan kelas background/shadow 
const solidHeaderClasses = 'bg-white shadow-md'; 
const transparentHeaderClasses = 'bg-transparent shadow-none';

const headerClasses = isHomePage ? transparentHeaderClasses : solidHeaderClasses;

// 2. Tentukan warna teks & logo: Default (Non-homepage) = Hitam, Homepage = Putih
const initialTextColor = isHomePage ? 'text-white' : 'text-gray-900'; 
const initialLogoSrc = isHomePage ? '/asset/images/logo-web.png' : '/asset/images/logo-web-dark.png';
---
<header
  id="main-header"
  data-is-home={isHomePage} 
  class={`header-transition fixed top-0 left-0 right-0 z-50 ${headerClasses}`}
>

  <div
    id="search-overlay"
    class="hidden fixed inset-0 z-[100] flex justify-center items-start pt-24 bg-gray-500/70 backdrop-blur-sm transition-opacity duration-300 opacity-0"
  >
    <div class="w-full max-w-4xl px-4">
      <div
        class="flex items-center bg-white shadow-2xl rounded-full p-2 h-14"
      >
        <i
          class="fa-solid fa-magnifying-glass text-gray-500 text-xl mx-3"
        ></i>

        <input
          id="mobile-search-input"
          type="search"
          placeholder="Cari Layanan atau Topik Bantuan (Contoh: Transkripsi, Closed Captioning)"
          class="w-full h-full border-0 focus:ring-0 text-gray-800 text-lg placeholder-gray-400 bg-transparent pr-4"
        />

        <button
          id="close-search"
          class="p-2 ml-2 text-gray-500 hover:text-lime-600 transition duration-150"
          aria-label="Tutup Pencarian"
        >
          <i class="fa-solid fa-xmark text-2xl"></i>
        </button>
      </div>
    </div>
  </div>

  <div class=" mx-auto px-4 md:px-20 lg:px-40">
    <div class="flex justify-between items-center h-16">
      <div class="flex items-center space-x-8">
        <div class="flex-shrink-0">
          <a href="/" class="logo-transition flex items-center">
            <img
              src={initialLogoSrc}
              alt="Aethersub Logo Premium"
              class="h-10 md:h-12 w-auto"
              id="header-logo" 
            />
          </a>
        </div>

        <nav class="hidden md:flex space-x-6 items-center" id="desktop-nav">
          <a
            href="/produk"
            class={`nav-link text-sm font-medium ${initialTextColor} nav-link-animated transition duration-150`}
            >PRODUCT</a
          >
          <a
            href="/about"
            class={`nav-link text-sm font-medium ${initialTextColor} nav-link-animated transition duration-150`}
            >ABOUT</a
          >
        </nav>
      </div>

      <div class="flex items-center space-x-2 md:space-x-4">
         
        <div id="desktop-search-group" class="flex items-center">
          <input
              id="desktop-search-input"
              type="search"
              placeholder="Cari Produk atau Bantuan..."
              class={`hidden md:block transition-all duration-300 ease-in-out h-8 
                     border border-gray-400 rounded-full px-4
                     bg-transparent ${initialTextColor} ${initialTextColor.replace('text-', 'placeholder-')} focus:outline-none focus:border-red-500 text-sm 
                     w-0 opacity-0`} 
          />

          <button
            class={`py-2 px-0 ${initialTextColor} hover:text-lime-600 transition duration-150`}
            id="open-search"
            data-search-state="closed" 
          >
           <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor" 
            >
              <path
               stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </button>
        </div>

        {/* CONTAINER ICON KERANJANG - FIX untuk perubahan warna scroll ada di header-logic.js */}
        <button
          class={`py-2 px-1 ${initialTextColor} hover:text-lime-600 relative transition duration-150`}
          id="cart-icon-container"
          onclick="window.location.href='/cart'"
        >
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 4a2 2 0 11-4 0 2 2 0 014 0z"
            />
          </svg>
          <span
            id="cart-count"
            class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 
bg-red-600 rounded-full"
            >0</span
          >
        </button>

        <button
          class={`md:hidden py-2 px-0 ${initialTextColor} hover:text-lime-600`}
          id="mobile-menu-icon"
          onclick="openMobileMenu()"
        >
          <svg
           class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
               stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

{/* ======================= 2. PRODUCT DETAIL MODAL ======================= */}
<div
  id="product-detail-modal"
  class="fixed inset-0 z-[110] hidden flex items-center justify-center p-4"
  aria-modal="true"
  role="dialog"
>
  <div
    class="absolute inset-0 bg-gray-900/80"
    id="product-detail-backdrop"
  ></div>
  <div
    class="bg-white rounded-xl shadow-2xl z-10 w-full max-w-4xl max-h-[95vh] overflow-y-auto transform transition-all duration-300"
  >
    <div
      class="sticky top-0 bg-white p-6 border-b flex justify-between items-center z-20"
    >
      <h3
        id="modal-product-name-header"
        class="text-xl font-bold text-gray-900 truncate"
      >
        Pilih Opsi Produk
      </h3>
      <button
        id="product-detail-close-button"
        class="text-gray-500 hover:text-lime-600 transition duration-150 p-1"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
           stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
       
        <div
          id="modal-product-image-main"
          class="w-full aspect-square bg-gray-200 rounded-lg overflow-hidden mb-4 bg-cover bg-center shadow-md border-2 border-gray-100 transition-all duration-300" 
          style="background-image: url('/asset/images/item-placeholder-1.jpg');" 
        ></div>

    
        <div
          id="modal-image-thumbnails"
          class="flex gap-2 overflow-x-auto pb-2"
        >
        
          <img 
            src="/asset/images/item-placeholder-1-thumb.jpg" 
            data-full-image="/asset/images/item-placeholder-1.jpg" 
            onclick="changeMainImage(this)"
            class="h-16 w-16 object-cover rounded-md cursor-pointer border-2 border-red-600 opacity-100 transition duration-200 thumbnail-item"
            alt="Detail Produk 1"
          />
          <img 
            src="/asset/images/item-placeholder-2-thumb.jpg" 
            data-full-image="/asset/images/item-placeholder-2.jpg" 
            onclick="changeMainImage(this)"
            class="h-16 w-16 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-red-600 transition duration-200 opacity-70 thumbnail-item"
            alt="Detail Produk 2"
          />
          <img 
            src="/asset/images/item-placeholder-3-thumb.jpg" 
            data-full-image="/asset/images/item-placeholder-3.jpg" 
            onclick="changeMainImage(this)"
            class="h-16 w-16 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-red-600 transition duration-200 opacity-70 thumbnail-item"
            alt="Detail Produk 3"
          />
        </div>

        <h4
          id="modal-product-name"
          class="text-2xl font-extrabold text-gray-900 mt-4"
        ></h4>
        <p
          id="modal-product-price"
          class="text-3xl font-bold text-lime-600 mt-1 mb-4"
        ></p>
        <p class="text-sm text-gray-600">
          Jersey kualitas premium dengan garansi kustom nama dan nomor gratis. Bahan Dri-FIT teknologi terbaru.
        </p>
      </div>

      <div class="space-y-6">
        <div class="border-b pb-4">
        
          <label class="block text-lg font-semibold text-gray-800 mb-2 flex justify-between items-center"
            >Pilih Ukuran <span class="text-lime-600">*</span>
            <button 
                id="toggle-size-chart" 
                onclick="toggleSizeChart()" 
                class="text-sm font-medium text-lime-600 hover:text-red-800 transition duration-150"
            >
                <i class="fa-solid fa-chart-bar mr-1"></i> Lihat Size Chart
            </button>
          </label>
        
          <div class="flex flex-wrap gap-2">
            <input
             type="radio"
              id="sizeS"
              name="size"
              value="S"
              class="hidden"
              required
            /><label
             for="sizeS"
              class="px-3 py-1 border rounded-full text-sm cursor-pointer hover:bg-red-50 hover:border-red-500"
            >
              S</label
            >
            <input
              type="radio"
              id="sizeM"
              name="size"
              value="M"
              class="hidden"
            /><label
              for="sizeM"
              class="px-3 py-1 border rounded-full text-sm cursor-pointer hover:bg-red-50 hover:border-red-500"
            >
              M</label
            >
            <input
              type="radio"
              id="sizeL"
              name="size"
              value="L"
             class="hidden"
              checked
            /><label
              for="sizeL"
              class="px-3 py-1 border rounded-full text-sm cursor-pointer hover:bg-red-50 hover:border-red-500"
            >
              L</label
            >
            <input
              type="radio"
              id="sizeXL"
              name="size"
              value="XL"
              class="hidden"
            /><label
              for="sizeXL"
              class="px-3 py-1 border rounded-full text-sm cursor-pointer hover:bg-red-50 hover:border-red-500"
            >
              XL</label
            >
          </div>
        </div>
        
  
        <div id="size-chart-content" class="hidden border rounded-lg p-3 bg-gray-50 transition-all duration-300">
            <h5 class="text-base font-bold text-gray-900 mb-2">Size Chart (Lebar Dada x Panjang)</h5>
            <table class="w-full text-sm text-gray-700">
                <thead>
                    <tr class="text-left font-semibold text-gray-600 border-b">
                        <th class="py-1">Ukuran</th>
                        <th class="py-1">Lebar (cm)</th>
                        <th class="py-1">Panjang (cm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td class="py-1">S</td><td class="py-1">48</td><td class="py-1">68</td></tr>
                    <tr><td class="py-1">M</td><td class="py-1">50</td><td class="py-1">70</td></tr>
                    <tr><td class="py-1">L</td><td class="py-1">52</td><td class="py-1">72</td></tr>
                    <tr><td class="py-1">XL</td><td class="py-1">54</td><td class="py-1">74</td></tr>
                </tbody>
            </table>
        </div>


      
          <div class="border-b pb-4">
          <label class="block text-lg font-semibold text-gray-800 mb-2"
            >Kustomisasi Nama & Nomor (Gratis)</label
          >
          <input
            id="custom-name"
            type="text"
            placeholder="Nama Punggung (Maks 10 karakter)"
            maxlength="10"
            class="w-full border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm mb-2"
          />
          <input
            id="custom-number"
            type="number"
            placeholder="Nomor Punggung (Maks 2 digit)"
            max="99"
            class="w-full border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm"
          />
        </div>

        <div>
          <label class="block text-lg font-semibold text-gray-800 mb-2"
            >Kuantitas</label
          >
          <input
            id="quantity-input"
            type="number"
            value="1"
            min="1"
            class="w-24 border-gray-300 rounded-lg text-center focus:ring-red-500 focus:border-red-500"
          />
        </div>
      </div>
    </div>

    <div class="p-6 border-t bg-gray-50 flex justify-end">
      <button
        id="add-to-cart-button"
        class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 flex items-center"
      >
        <svg
          class="w-5 h-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
           stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 4a2 2 0 11-4 0 2 2 0 014 0z"
          />
        </svg>
        Tambahkan ke Keranjang
      </button>
    </div>
  </div>
</div>

{/* ======================= 3. MOBILE MENU SIDEBAR ======================= */}
<div 
    id="mobile-menu-overlay" 
    class="fixed inset-0 bg-gray-900/50 z-40 hidden opacity-0 transition-opacity duration-300"
    onclick="closeMobileMenu()"
></div>

<div
    id="mobile-menu-sidebar"
    class="fixed top-4 right-0 w-64 h-full  bg-white z-50 transform rounded-2xl translate-x-full transition-transform duration-300 shadow-2xl p-6" 
>
    <div class="flex justify-between items-center mb-8 border-b pb-4">
        <span class="text-xl font-extrabold text-lime-600">MENU</span>
        <button onclick="closeMobileMenu()" class="text-gray-500 hover:text-lime-600 p-2 rounded-full transition duration-150" aria-label="Tutup Menu">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
    
    <nav class="space-y-1">
        
        <a 
            href="/produk" 
            class={`block text-base font-semibold px-4 py-3 rounded-lg transition duration-150 ${
                currentPath.startsWith('/produk') // <-- KONDISI DIPERBAIKI
                    ? 'bg-lime-600 text-white hover:bg-lime-700'
                    : 'text-gray-800 hover:text-white hover:bg-lime-600'
            }`} 
            onclick="closeMobileMenu()"
        >
            <i class="fa-solid fa-shirt w-5 mr-3"></i> PRODUCT
        </a>
        
        <a 
            href="/about" 
            class={`block text-base font-semibold px-4 py-3 rounded-lg transition duration-150 ${
                currentPath.startsWith('/about')
                    ? 'bg-lime-600 text-white hover:bg-lime-700'
                    : 'text-gray-800 hover:text-white hover:bg-lime-600'
            }`}
            onclick="closeMobileMenu()"
        >
            <i class="fa-solid fa-circle-info w-5 mr-3"></i> ABOUT
        </a>
        
        <div class="pt-4 mt-4 border-t"></div>

        <a 
            href="#faq-modal" 
            onclick="openFAQModal(); closeMobileMenu();"
            class="block text-sm font-medium text-gray-600 hover:text-gray-900 px-4 py-2 transition duration-150"
        >
            <i class="fa-solid fa-circle-question w-5 mr-3"></i> FAQ & Bantuan
        </a>
        <a 
            href="/login" 
            class="block text-sm font-medium text-gray-600 hover:text-gray-900 px-4 py-2 transition duration-150"
            onclick="closeMobileMenu()"
        >
            <i class="fa-solid fa-right-to-bracket w-5 mr-3"></i> Akun Saya
        </a>
    </nav>
</div>


{/* ======================= 4. CATEGORY SIDEBAR (TAMBAHAN FIX) ======================= */}
<div 
    id="category-sidebar-overlay" 
    class="fixed inset-0 bg-gray-900/50 z-40 hidden opacity-0 transition-opacity duration-300"
    onclick="closeCategorySidebar()"
></div>

<div
    id="category-sidebar"
    class="fixed top-0 left-0 w-64 h-full bg-white z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl p-6" 
>
    <div class="flex justify-between items-center mb-8 border-b pb-4">
        <span class="text-xl font-extrabold text-lime-600">KATEGORI</span>
        <button id="category-close-button" class="text-gray-500 hover:text-lime-600 p-2 rounded-full transition duration-150" aria-label="Tutup Sidebar Kategori">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
    
    <nav class="space-y-1">
        {/* Konten Kategori akan diisi di Produk.astro atau secara dinamis */}
        <a href="/produk" class="block text-base font-semibold px-4 py-3 rounded-lg text-gray-800 hover:text-white hover:bg-lime-600 transition duration-150">
            Semua Produk
        </a>
        <a href="/produk?cat=timnas" class="block text-sm font-medium text-gray-600 hover:text-gray-900 px-4 py-2 transition duration-150">
            Jersey Timnas
        </a>
        <a href="/produk?cat=Training" class="block text-sm font-medium text-gray-600 hover:text-gray-900 px-4 py-2 transition duration-150">
            Training
        </a>
        <a href="/produk?cat=retro" class="block text-sm font-medium text-gray-600 hover:text-gray-900 px-4 py-2 transition duration-150">
            Jersey Retro
        </a>
    </nav>
</div>

<script type="module" src="/scripts/header-logic.js" is:inline></script>
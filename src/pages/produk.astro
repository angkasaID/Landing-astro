---
// src/pages/produk.astro
// @ts-nocheck

import BaseLayout from '../layouts/BaseLayout.astro';

const title = "Katalog Produk | AetherSub";

// --- 2. FUNGSI UTILITY & FORMAT RUPIAH ---
/**
 * @param {number | null | undefined} price
 * @returns {string}
 */
const formatRupiah = (price) => {
    if (price === null || price === undefined) return '';
    return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0,
    }).format(price);
};


const productCategorySlug = (name) => 
    name.toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/[\s-]+/g, '-')
        .replace(/^-*|-*$/g, '');


/** @type {Product[]} */
const products = [
  {
    id: 101,
    name: "Jersey Home Timnas Garuda 2024 Premium",
    price: 129000,
    oldPrice: 199000,
    isNew: true,
    isSale: true,
    rating: 4.9,
    category: "Timnas", 
    imageSrc: "https://placehold.co/600x600/CCCCCC/000000?text=P101%20HOME", 
    images: [

        { thumb: "https://placehold.co/100x100/EEEEEE/333333?text=T101-1", full: "https://placehold.co/600x600/CCCCCC/000000?text=P101%20FULL%201" },

        { thumb: "https://placehold.co/100x100/D4A4B4/333333?text=T101-2", full: "https://placehold.co/600x600/D4A4B4/000000?text=P101%20FULL%202" }
    ],
  },
  {
    id: 102,
    name: "Jersey Away Timnas Garuda 2024 (Putih)",
    price: 129000,
    oldPrice: 199000,
    isNew: false,
    isSale: true,
    rating: 4.7,
    category: "timnas-2024",
    imageSrc: "https://placehold.co/600x600/CCCCCC/000000?text=P102%20AWAY",
    images: [{ thumb: "https://placehold.co/100x100/EEEEEE/333333?text=T102", full: "https://placehold.co/600x600/CCCCCC/000000?text=P102%20FULL" }],
  },
  {
    id: 105,
    name: "Jersey Retro Home 2004 Legend Collection",
    price: 155000,
    oldPrice: 220000,
    isNew: false,
    isSale: false,
    rating: 4.8,
    category: "Retro",
    imageSrc: "https://placehold.co/600x600/CCCCCC/000000?text=P105%20RETRO",
    images: [{ thumb: "https://placehold.co/100x100/EEEEEE/333333?text=T105", full: "https://placehold.co/600x600/CCCCCC/000000?text=P105%20FULL" }],
  },
  {
    id: 104,
    name: "Jersey Training Timnas Merah Premium",
    price: 99000,
    oldPrice: null,
    isNew: false,
    isSale: false,
    rating: 4.5,
    category: "Retro",
    imageSrc: "https://placehold.co/600x600/CCCCCC/000000?text=P104%20TRAINING",
    images: [{ thumb: "https://placehold.co/100x100/EEEEEE/333333?text=T104", full: "https://placehold.co/600x600/CCCCCC/000000?text=P104%20FULL" }],
  },
];

const categories = [
    { name: "Semua Produk", slug: "all" },
    { name: "Timnas 2024", slug: "timnas-2024" },
    { name: "retro", slug: "retro" },
    { name: "Training", slug: "training" },
    { name: "Aksesoris", slug: "aksesoris" }, 
];

// --- 4. LOGIKA FILTERING ---
const currentCategorySlug = Astro.url.searchParams.get('category') 
    || Astro.url.searchParams.get('cat') 
    || 'all'; 

const filteredProducts = products.filter(product => {
    if (currentCategorySlug === 'all') {
        return true;
    }
    
    if (currentCategorySlug === 'diskon') {
        return product.isSale === true;
    }
    
    const productSlug = productCategorySlug(product.category);
    
    return productSlug === currentCategorySlug;
});

---





<BaseLayout title={title}>
    <div class="pt-24 md:pt-32 bg-gray-50 min-h-screen">
        <div class="container mx-auto px-4 md:px-8 lg:px-16 py-8 md:py-12">
            
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                    Katalog Jersey <span class="text-lime-600 font-judul2">Aethersub</span>
                </h1>
            </header>
            <div class="px-4 md:px-8 lg:px-40 pt-10 pb-4 md:hidden">
    <button
        onclick="openCategorySidebar()"
        class="w-full py-3 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition duration-150 flex items-center justify-center text-lg"
        aria-label="Buka Filter Kategori"
    >
        <i class="fa-solid fa-tags mr-3"></i> Pilih Kategori Produk
    </button>
</div>

            <div class="flex flex-col md:flex-row gap-8">
                
                <aside class="md:w-1/4 hidden md:block">
                    <div class="bg-white p-6 rounded-xl shadow-lg sticky top-28">
                        <h2 class="text-xl font-bold text-red-600 mb-4">
                            Kategori Produk
                        </h2>
                        <nav class="space-y-2">
                            {categories.map((category) => {
                                const isActive = category.slug === currentCategorySlug;
                                const activeClasses = isActive ? 'bg-red-50 text-red-600 font-bold border-red-600' : 'text-gray-700 hover:text-lime-600 hover:bg-gray-50';
                                
                                return (
                                    <a 
                                        href={`/produk?category=${category.slug}`} 
                                        class={`flex justify-between items-center transition duration-150 p-2 rounded-lg border border-transparent ${activeClasses}`}
                                    >
                                        <span class="font-medium">{category.name}</span>
                                    </a>
                                )
                            })}
                        </nav>
                        
                        <div class="mt-6 pt-4 border-t">
                            <h3 class="text-base font-semibold text-gray-600 mb-2">Filter Tambahan</h3>
                            <a href="/produk?category=diskon" 
                                class={`w-full text-center block p-2 rounded-lg text-sm transition duration-150 ${currentCategorySlug === 'diskon' ? 'bg-red-600 text-white font-bold' : 'text-red-600 border border-red-600 hover:bg-red-50'}`}
                            >
                                Produk Diskon Saja
                            </a>
                        </div>
                    </div>
                </aside>

                <main class="w-full md:w-3/4">
                    {filteredProducts.length === 0 && (
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-lg">
                            <p class="font-semibold">Produk Tidak Ditemukan</p>
                            <p class="text-sm">Maaf, tidak ada produk yang cocok dengan kategori ini. <a href="/produk" class="underline hover:text-red-600">Tampilkan Semua Produk</a></p>
                        </div>
                    )}
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-4 lg:gap-5">

                        
                      
                        {filteredProducts.map((product) => (
                            <div class="group bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 
            overflow-hidden flex flex-col border border-gray-100">

    <!-- Gambar -->
    <div class="relative h-48 sm:h-64 overflow-hidden">
        <img 
            src={product.imageSrc}
            alt={product.name}
            loading="lazy"
            class="w-full h-full object-cover transition duration-500 group-hover:scale-105"
        />

        <!-- Badge -->
        <div class="absolute top-3 left-3 flex gap-2">
            {product.isNew && (
                <span class="bg-lime-600/90 backdrop-blur px-3 py-[2px] text-xs
                              font-semibold text-white rounded-full shadow">
                    BARU
                </span>
            )}
            {product.isSale && (
                <span class="bg-red-600/90 backdrop-blur px-3 py-[2px] text-xs 
                              font-semibold text-white rounded-full shadow">
                    DISKON
                </span>
            )}
        </div>
    </div>

    <!-- Konten -->
    <div class="p-4 flex flex-col flex-1">

        <!-- Nama -->
        <h2 class="text-base sm:text-lg font-semibold text-gray-900 line-clamp-2 mb-1">
            {product.name}
        </h2>

        <!-- Rating -->
        <div class="flex items-center text-yellow-500 text-xs mt-[2px] mb-3">
            <i class="fa-solid fa-star text-[12px]"></i>
            <span class="ml-1 text-gray-600">{product.rating}</span>
        </div>

        <!-- Harga -->
        <div class="mt-auto mb-3">
            <span class="text-xl font-extrabold text-red-600">
                {formatRupiah(product.price)}
            </span>

            {product.oldPrice && (
                <span class="text-sm text-gray-400 line-through ml-2">
                    {formatRupiah(product.oldPrice)}
                </span>
            )}
        </div>

        <!-- Tombol -->
        <button
            class="open-product-modal w-full py-2.5 
                   bg-lime-600 text-white font-semibold rounded-full 
                   hover:bg-lime-700 transition duration-200 text-sm
                   shadow-sm hover:shadow-md"
            
            data-product-id={product.id}
            data-product-name={product.name}
            data-product-price={product.price}
            data-product-images={JSON.stringify(product.images)}
        >
            Beli Sekarang
        </button>
    </div>
</div>

                        ))}

                    </div>
                    
                  
                    {filteredProducts.length > 0 && (
                        <div class="flex justify-center mt-12">
                            <a href="#" class="text-lg text-red-600 hover:text-lime-600 font-semibold">Lihat Lebih Banyak &rarr;</a>
                        </div>
                    )}
                </main>
            </div>
            
        </div>
    </div>
</BaseLayout>